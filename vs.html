<body class="bg-gray-100">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>


<div class="bg-white p-6 mx-auto rounded-lg shadow-md overflow-hidden" style="width: 800px">

    <div>
        <!-- Players Cards -->

        <div class="flex flex-wrap align-items-center justify-content-center -mx-2">

            <!-- Player 1 -->
            <!-- "w-1/2 p-2" -->
            <div class="w-1/2 p-1">
                <div class="rounded-t-lg p-4 text-white team-bg">
                    <div class="flex items-center">
                        <img src="https://placehold.co/64x64"
                             class="rounded-full h-16 w-16" id="player-img">
                        <div class="ml-4">
                            <div class="font-bold" style="font-size: 20px;" id="player-team">team1</div>
                            <div class="font-bold" id="player-name-get" style="font-size: 20px;">player</div>
                            <div id="Position-get" style="font-size: 18px;">position</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Player 2 -->
            <div class="w-1/2 p-1">
                <div class="rounded-t-lg p-4 text-white" id="vs-team-bg">
                    <div class="flex items-center">
                        <img src="https://placehold.co/64x64"
                             class="rounded-full h-16 w-16" id="vs-player-img">
                        <div class="ml-4">

                            <div>
                                <select name="team" class="select font-bold" id="vs-team"
                                        style="background-color: transparent; height: 24px; font-size: 20px; margin-bottom: 4px;">
                                    <option value="Arsenal" data-color="#F00000">Arsenal</option>
                                    <option value="Chelsea" data-color="#001489">Chelsea</option>
                                    <option value="Liverpool" data-color="#DC0714">Liverpool</option>
                                    <option value="Manchester City" data-color="#98C5E9">Manchester City</option>
                                    <option value="Manchester Utd" data-color="#C70101">Manchester Utd</option>
                                    <option value="Tottenham" data-color="#111836">Tottenham</option>
                                </select>
                            </div>
                            <select class="select font-bold" id="vs-player"
                                    style="background-color: transparent; font-size: 20px; margin-top:4px">player2</select>
                            <div id="vs-Position-get" style="padding-left: 5px; font-size: 18px; margin-top: 1px;">
                                position
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex-column">
                <div class="flex justify-content-center"><label for="select-stat"></label>
                    <select id="select-stat" class="align-items-center font-bold" style="width: fit-content">
                        <option value="standard">standard</option>
                        <option value="pass">pass</option>
                        <option value="depend">depend</option>
                        <option value="shoot">shoot</option>
                        <option value="GK">goalkeeping</option>
                    </select>
                </div>
                <div class="flex">
                    <div class="flex-column space-y-2 player-1-stat-plus text-red-800 text-sm p-4"

                    >
                    </div>
                    <div class="flex-column space-y-2 player-1-stat p-4 text-sm">
                    </div>
                    <div class="flex align-items-center justify-content-center bg-white rounded-b-lg p-4">
                        <div class="text-gray-800 flex-column align-items-center font-bold text-xl mb-2">
                            <div class="space-y-2 stat-box-of-type flex-column align-items-center">
                                <div id="stat-list" class="align-items-center"></div>
                            </div>
                        </div>
                    </div>
                    <div class="flex-column space-y-2 player-2-stat p-4 text-sm">
                    </div>
                    <div class="flex-column space-y-2 player-2-stat-plus text-red-800 text-sm p-4">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="flex justify-center items-center">
        <button id="go-back">return</button>
    </div>
</div>
</body>

<script type="text/javascript">

    $(function () {
        // 기존 코드 유지...
        fetch(
            `https://stable-redbird-sunny.ngrok-free.app/players/${playerDivId}`,
            {
                headers: {
                    "Content-Type": "application/json",
                    "ngrok-skip-browser-warning": "69420",
                },
            }
        )
            .then((response) => response.json())
            .then((player) => {
                if (player) {
                    document.querySelector("#player-name-get").textContent = player.name;
                    document.querySelectorAll(".team-bg").forEach(el => {
                        const squadName = player.squad.name
                        const col = squadName === "Arsenal" ? "#F00000" :
                            squadName === "Chelsea" ? "#001489" :
                                squadName === "Liverpool" ? "#DC0714" :
                                    squadName === "Manchester City" ? "#98C5E9" :
                                        squadName === "Manchester Utd" ? "#C70101" :
                                            squadName === "tottenham" ? "#111836" : "#242424"
                        el.style.backgroundColor = col
                    })
                    document.querySelector("#player-img").src = player.profileUrl;
                    document.querySelector("#Position-get").textContent = player.positions;
                    document.querySelector("#player-team").textContent = player.squad.name;

                } else {
                    document.querySelector(".player-name").textContent = "Player Not Found";
                }
            })
            .catch(error => {
                console.error("Error fetching JSON:", error);
            });
        // 뒤로가기 링크 클릭 이벤트 리스너
        document.querySelector("#go-back").addEventListener("click", () => {
            $.ajax({
                url: "playerDetail.html",
                dataType: "html",
                success: function (data) {
                    // 클릭된 플레이어의 ID를 playerDetail.html에 전달
                    $(".modal-content p").html(data);
                }

            })
        })
    });

    let statType = "standard";
    const excludes = ["s90", "ranks", "id"];

    function changestat() {
        fetch(
            `https://stable-redbird-sunny.ngrok-free.app/players/${playerDivId}/records?type=${
                statType ? statType : "standard"
            }`,
            {
                headers: {
                    "Content-Type": "application/json",
                    "ngrok-skip-browser-warning": "69420",
                },
            }
        )
            .then((data) => data.json())
            .then((records) => {
                //console.log(records);
                $("#stat-list").empty();
                $('.player-1-stat').empty()
                playerStat = records;
                for (let columnName in records) {
                    if (excludes.includes(columnName)) {
                        continue;
                    }
                    const row1 = `<div class="flex justify-content-around">
                        <div class="text-sm font-medium text-gray-700" style="margin-bottom: 8px">
                          ${columnName.replace(/([a-z])([A-Z])/g, "$1 $2")}
                        </div>
                </div>`;
                    $("#stat-list").append(row1);
                    $('.player-1-stat').append`<div className="text-sm">${records[columnName]}</div>`
                }
                vschangestat()
            });
    }

    changestat();

    $("#select-stat").on("change", function () {
        //selected value
        $(this).val();
        $("option:selected", this).attr("value");
        statType = $(this).val();
        //console.log(statType);
        changestat();
    });

    let vsTeam = "Arsenal";
    $("#vs-team").on("change", function () {
        //selected value
        $(this).val();
        $("option:selected", this).attr("value");
        vsTeam = $(this).val();
        //console.log(vsTeam);
        changestat(vsTeam);
        vsPlayerselect();
    });
    vsPlayerselect();

    let vsPlayerId;
    // let vsplayerImg
    // let vsplayerTeam    
    let vsPlayerStat;
    let playerStat;

    function vsPlayerselect() {
        //vsTeam 따라서 fetch를 다르게
        fetch(`https://stable-redbird-sunny.ngrok-free.app/players?squadName=${vsTeam}`,
            {
                headers: {
                    "Content-Type": "application/json",
                    "ngrok-skip-browser-warning": "69420",
                },
            }).then((data) => data.json()).then((data) => {
            //console.log(data);

            for (var i in data) {
                vsPlayer = data[i];
                //console.log(vsPlayer)
                let option = `<option value="${vsPlayer.id}">${vsPlayer.name}</option>`;
                $("#vs-player").append(option);
            }
            //console.log(data[0].id);
            vsPlayerId = data[0].id;
            // vsplayerImg=data[0].profileUrl;
            // vsplayerTeam=data[0].team;
            // console.log(vsplayerImg);
            // console.log(vsplayerTeam);
            vschangestat();
            vsPlayerinfo();
        })

    }

    $("#vs-player").on("change", function () {
        //selected value
        //   $(this).val();
        //   $("option:selected", this).attr("value");
        vsPlayerId = $(this).val();
        //console.log(vsPlayerId);
        vschangestat();
        vsPlayerinfo();
    });

    function vsPlayerinfo() {
        fetch(
            `https://stable-redbird-sunny.ngrok-free.app/players/${vsPlayerId}`,
            {
                headers: {
                    "Content-Type": "application/json",
                    "ngrok-skip-browser-warning": "69420",
                },
            }
        )
            .then((response) => response.json())
            .then((response) => {
                console.log(response)
                document.querySelector("#vs-Position-get").textContent = response.positions;
                document.querySelector("#vs-player-img").src = response.profileUrl;
            })
            .catch(error => {
                console.error("Error fetching JSON:", error);
            });
    }


    let vsstatType = "standard";

    $("#vs-select-stat").on("change", function () {
        //selected value
        $(this).val();
        $("option:selected", this).attr("value");
        vsstatType = $(this).val();
        // console.log($(this).val());
        //console.log(vsstatType);
        vschangestat();
    });


    function vschangestat() {
        if (!vsPlayerId) {
            console.error("vsPlayerId is not defined.");
            return;
        }
        fetch(
            `https://stable-redbird-sunny.ngrok-free.app/players/${vsPlayerId}/records?type=${
                statType ? statType : "standard"
            }`,
            {
                headers: {
                    "Content-Type": "application/json",
                    "ngrok-skip-browser-warning": "69420",
                },
            }
        )
            .then((data) => data.json())
            .then((records) => {
                //console.log(records)
                $('.player-2-stat').empty()
                $(".player-1-stat-plus").empty()
                $(".player-2-stat-plus").empty()
                vsPlayerStat = records;
                for (let columnName in records) {
                    if (excludes.includes(columnName)) {
                        continue;
                    }
                    const row2 = `
                        <div class="text-sm">${records[columnName]}</div>
                `;
                    $(".player-2-stat").append(row2);
                    let value= playerStat[columnName] - vsPlayerStat[columnName]
                    $(".player-1-stat-plus")
                        .append(`<div class="text-sm" style="height: 1.25rem; min-width: 99px">${value > 0 ? `▲ `+ value.toFixed(2) : '            '}</div>`)
                    $(".player-2-stat-plus")
                        .append(`<div class="text-sm" style="height: 1.25rem; min-width: 99px">${value < 0 ? `▲ `+ -value.toFixed(2) : '            '}</div>`)
                }
            });
    }

    vschangestat()


    function changeBackgroundPlayer2() {
        $("#vs-player").empty();
        var selectedTeamColor = $("#vs-team option:selected").data("color");
        $("#vs-team-bg").css("background-color", selectedTeamColor);

        var options =
            $("#vs-team option").filter(function (e) {
                return $(this).attr("value") > $("#vs-team option:selected").val();
            }).clone();
        ///(`
        //                 players ? squadName =${$(this).attr("value")}`
        //$("#vs-player").append(options);
    }

    changeBackgroundPlayer2();
    $(function () {
        $("#vs-team").change((e) => changeBackgroundPlayer2(e));
    });


</script>

<!-- </html> -->